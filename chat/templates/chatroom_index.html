{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
		<meta charset="utf-8">
		<title>Swipe - The Simplest Chat Platform</title>
		<meta name="description" content="#">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<!-- Bootstrap core CSS -->
		<link href="{% static 'dist/css/lib/bootstrap.min.css' %}" type="text/css" rel="stylesheet">
		<!-- Swipe core CSS -->
		<link href="{% static 'dist/css/swipe.min.css' %}" type="text/css" rel="stylesheet">
		<!-- Favicon -->
		<link href="{% static 'dist/img/favicon.png' %}" type="image/png" rel="icon">
	</head>

<style>


.dropbtn {
  /* background-color: #3498DB; */
  color: rgb(88, 88, 88);
  /* padding: 16px; */
  font-size: 16px;
  border: none;
  cursor: pointer;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  overflow: auto;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

/* .dropdown a:hover {background-color: #ddd;} */

.show {display: block;}



* {
  padding: 0;
  margin: 0;
}

body {
  background: #e9eaed;
  font-family: arial, sans-serif;
}

.field-reactions:checked:focus ~ .text-desc, .field-reactions, [class*=reaction-], .text-desc {
  clip: rect(1px, 1px, 1px, 1px);
  overflow: hidden;
  position: absolute;
  top: 0;
  left: 0;
}

.field-reactions:checked ~ [class*=reaction-], .box:hover [class*=reaction-], .field-reactions:focus ~ .text-desc {
  clip: auto;
  overflow: visible;
  opacity: 1;
}

.main-title {
  background: #3a5795;
  padding: 10px;
  color: #fff;
  text-align: center;
  font-size: 16px;
  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
}

.text-desc {
  font-weight: normal;
  text-align: center;
  transform: translateY(-50px);
  white-space: nowrap;
  font-size: 13px;
  width: 100%;
}

[class*=reaction-] {
  border: none;
  background-image: url(http://deividmarques.github.io/facebook-reactions-css/assets/images/facebook-reactions.png);
  background-color: transparent;
  display: block;
  cursor: pointer;
  height: 48px;
  position: absolute;
  width: 48px;
  z-index: 11;
  top: -28;
  transform-origin: 50% 100%;
  transform: scale(0.1);
  transition: all 0.3s;
  outline: none;
  will-change: transform;
  opacity: 0;
}

.box {
  position: absolute;
  left: calc(50% - 150px);
  top: calc(50% - 50px);
  width: 300px;
}

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9;
  visibility: hidden;
}

.field-reactions:focus ~ .label-reactions {
  border-color: rgba(88, 144, 255, 0.3);
}
.field-reactions:checked:focus ~ .label-reactions {
  border-color: transparent;
}
.label-reactions {
  background: url(https://cdn4.iconfinder.com/data/icons/facebook-likes/100/1.png) no-repeat 0 0;
  border: 2px dotted transparent;
  display: block;
  height: 100px;
  margin: 0 auto;
  width: 100px;
  color: transparent;
  cursor: pointer;
}

.toolbox {
  background: #fff;
  height: 52px;
  box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.08), 0 2px 2px rgba(0, 0, 0, 0.15);
  width: 300px;
  border-radius: 40px;
  top: -30px;
  left: 0;
  position: absolute;
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.15s;
}

.legend-reaction {
  background: rgba(0, 0, 0, 0.75);
  border-radius: 10px;
  box-sizing: border-box;
  color: #fff;
  display: inline-block;
  font-size: 11px;
  text-overflow: ellipsis;
  font-weight: bold;
  line-height: 20px;
  max-width: 100%;
  opacity: 0;
  overflow: hidden;
  padding: 0 6px;
  transition: opacity 50ms ease;
  left: 50%;
  position: absolute;
  text-align: center;
  top: -28px;
  transform: translateX(-50%);
}

.box:hover [class*=reaction-] {
  transform: scale(0.8) translateY(-40px);
}
.box:hover [class*=reaction-]:hover, .box:hover [class*=reaction-]:focus {
  transition: all 0.2s ease-in;
  transform: scale(1) translateY(-35px);
}
.box:hover [class*=reaction-]:hover .legend-reaction, .box:hover [class*=reaction-]:focus .legend-reaction {
  opacity: 1;
}
.box:hover .toolbox {
  opacity: 1;
}
.box:hover .toolbox {
  visibility: visible;
}
.box:hover .reaction-love {
  transition-delay: 0.06s;
}
.box:hover .reaction-haha {
  transition-delay: 0.09s;
}
.box:hover .reaction-wow {
  transition-delay: 0.12s;
}
.box:hover .reaction-sad {
  transition-delay: 0.15s;
}
.box:hover .reaction-angry {
  transition-delay: 0.18s;
}

.field-reactions:checked ~ [class*=reaction-] {
  transform: scale(0.8) translateY(-40px);
}
.field-reactions:checked ~ [class*=reaction-]:hover, .field-reactions:checked ~ [class*=reaction-]:focus {
  transition: all 0.2s ease-in;
  transform: scale(1) translateY(-35px);
}
.field-reactions:checked ~ [class*=reaction-]:hover .legend-reaction, .field-reactions:checked ~ [class*=reaction-]:focus .legend-reaction {
  opacity: 1;
}
.field-reactions:checked ~ .toolbox {
  opacity: 1;
}
.field-reactions:checked ~ .toolbox,
.field-reactions:checked ~ .overlay {
  visibility: visible;
}
.field-reactions:checked ~ .reaction-love {
  transition-delay: 0.03s;
}
.field-reactions:checked ~ .reaction-haha {
  transition-delay: 0.09s;
}
.field-reactions:checked ~ .reaction-wow {
  transition-delay: 0.12s;
}
.field-reactions:checked ~ .reaction-sad {
  transition-delay: 0.15s;
}
.field-reactions:checked ~ .reaction-angry {
  transition-delay: 0.18s;
}

.reaction-like {
  left: 0;
  background-position: 0 -144px;
}

.reaction-love {
  background-position: -48px 0;
  left: 50px;
}

.reaction-haha {
  background-position: -96px 0;
  left: 100px;
}

.reaction-wow {
  background-position: -144px 0;
  left: 150px;
}

.reaction-sad {
  background-position: -192px 0;
  left: 200px;
}

.reaction-angry {
  background-position: -240px 0;
  left: 250px;
}

	
</style>


	<body>
		<main>
			<div class="layout">
				<!-- Start of Navigation -->
				<div class="navigation">
					<div class="container">
						<div class="inside">
							<div class="nav nav-tab menu">
								<button class="btn"><img class="avatar-xl" src="/{{user_profile.prof_image}}" alt="avatar"></button>
								<a href="#members" data-toggle="tab"><i class="material-icons">account_circle</i></a>
								<a href="#discussions" data-toggle="tab" class="active"><i class="material-icons active">chat_bubble_outline</i></a>
								<a href="#notifications" data-toggle="tab" class="f-grow1"><i class="material-icons">notifications_none</i></a>
								<button class="btn mode"><i class="material-icons">brightness_2</i></button>
								<a href="#settings" data-toggle="tab"><i class="material-icons">settings</i></a>
								<a href="/logout"><button class="btn power"><i class="material-icons">power_settings_new</i></button></a>
							</div>
						</div>
					</div>
				</div>
				<!-- End of Navigation -->
				<!-- Start of Sidebar -->
				<div class="sidebar" id="sidebar">
					<div class="container">
						<div class="col-md-12">
							<div class="tab-content">
								<!-- Start of Contacts -->
								<div class="tab-pane fade" id="members">
									<div class="search">
										<form class="form-inline position-relative">
											<input type="search" class="form-control" id="people" placeholder="Search for people...">
											<button type="button" class="btn btn-link loop"><i class="material-icons">search</i></button>
										</form>
										<button class="btn create" data-toggle="modal" data-target="#exampleModalCenter"><i class="material-icons">person_add</i></button>
									</div>
									<div class="list-group sort">
										<button class="btn filterMembersBtn active show" data-toggle="list" data-filter="all">All</button>
										<button class="btn filterMembersBtn" data-toggle="list" data-filter="online">Online</button>
										<button class="btn filterMembersBtn" data-toggle="list" data-filter="offline">Offline</button>
									</div>
									<div class="contacts">
										
										<!-- CREATE GROUPS MODAL BELOW -->

										<button class="btn btn-danger" style="background-color:#dc3545;" data-toggle="modal" data-target="#group_id">Create Group</button>

										<div id="group_id" class="modal fade forget-modal" tabindex="-1" role="dialog" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered" role="document">
												<div class="requests">
													<div class="title">
														<h1>Create Groups</h1>
														<button type="button" class="btn" data-dismiss="modal" aria-label="Close"><i class="material-icons">close</i></button>
													</div>
													<div class="content">
															<div class="form-group">
																<form action="/create_group/" method="post">
																	{% csrf_token %}
																	<center>
																		<img class="avatar-lg" src="https://cdn-icons-png.flaticon.com/128/1357/1357616.png" style="height:100px;max-width:100px;margin-top:-50px;" data-toggle="tooltip" data-placement="top" alt="avatar"><br>
																		<input class="form-control" type="text" name="group_name_form" required>
																	</center>
																	<button type="submit" class="btn btn-primary">Create</button>
																</form>
															</div>
															<div class="form-group">
																<h5 id="{{notification.id}}__msg"><b>{{notification.message|capfirst}}</b></h5>
															</div>
													</div>
												</div>
											</div>
										</div>


										<h1>Contacts</h1>
										<div class="list-group" id="contacts" role="tablist">
											{% for users in profiles.all %}

												<a href="#" class="filterMembers all online contact" data-toggle="list">
													<img class="avatar-md" src="/{{users.prof_image}}" data-toggle="tooltip" data-placement="top" title="{{users.user.username}}" alt="avatar">
													<div class="status">
														<i class="material-icons online">fiber_manual_record</i>
													</div>
													<div class="data">
														<h5>{{users.user.username}}</h5>
														<p>{{users.city}}, {{users.country}}</p>
													</div>
													{% if users not in user_profile.friends.all %}
													<div class="">
														<i data-toggle="modal" data-target="#FriendRequestModal_{{users.id}}" class="material-icons">person_add</i>
													</div>
													{% endif %}
												</a>
												
												<div id="FriendRequestModal_{{users.id}}" class="modal fade forget-modal" tabindex="-1" role="dialog" aria-hidden="true">
													<div class="modal-dialog modal-dialog-centered" role="document">
														<div class="requests">
															<div class="title">
																<!-- <h1>Add your friends</h1> -->
																<button type="button" class="btn" data-dismiss="modal" aria-label="Close"><i class="material-icons">close</i></button>
															</div>
															<div class="content">
																<form id="freq_form_{{users.id}}" onsubmit="event.preventDefault(); friend_form('freq_form_{{users.id}}','{{users.id}}');">
																	<div class="form-group">
																		<center>
																			<img class="avatar-lg" src="/{{users.prof_image}}" style="height:100px;max-width:100px;margin-top:-50px;" data-toggle="tooltip" data-placement="top" alt="avatar"><br>
																			<br><h5 style="color:rgb(20, 20, 20)"><b>{{users.user.username|capfirst}}</b></h5>
																		</center>
																	</div>
																	<div class="form-group">
																		<label for="welcome">Message:</label>
																		<textarea id="freq_msg_{{users.id}}" style="color:rgb(29, 28, 28)!important;" class="text-control" placeholder="Send message...">Hi {{users.user.username|capfirst}}, I'd like to add you as a friend.</textarea>
																	</div>
																	{% if users.id in friend_req %}
																		<button type="submit" style="background-color:#14a44d; opacity:0.5;" disabled class="btn button w-100">Request Already Sent</button>
																	{% else %}
																		<button type="submit" class="btn button w-100">Send Friend Request</button>
																	{% endif %}
																</form>
															</div>
														</div>
													</div>
												</div>
											{% endfor %}
										</div>
									</div>
								</div>
								<!-- End of Contacts -->
								<!-- Start of Discussions -->
								<div id="discussions" class="tab-pane fade active show">
									<div class="search">
										<form class="form-inline position-relative">
											<input type="search" class="form-control" id="conversations" placeholder="Search for conversations...">
											<button type="button" class="btn btn-link loop"><i class="material-icons">search</i></button>
										</form>
										<button class="btn create" data-toggle="modal" data-target="#startnewchat"><i class="material-icons">create</i></button>
									</div>
									<div class="list-group sort">
										<button class="btn filterDiscussionsBtn active show" data-toggle="list" data-filter="all">All</button>
										<button class="btn filterDiscussionsBtn" data-toggle="list" data-filter="read">Read</button>
										<button class="btn filterDiscussionsBtn" data-toggle="list" data-filter="unread">Unread</button>
									</div>						
									<div class="discussions">
										<h1>Discussions</h1>
									<!-- <div class="box">
										<input type="checkbox" id="like" class="field-reactions">
										<h3 class="text-desc">Press space and after tab key to navigation</h3>
										<label for="like" class="label-reactions">Like</label>
										<div class="toolbox"></div>
										<label class="overlay" for="like"></label>
										<button class="reaction-like"><span class="legend-reaction">Like</span></button>
										<button class="reaction-love"><span class="legend-reaction">Love</span></button>
										<button class="reaction-haha"><span class="legend-reaction">Haha</span></button>
										<button class="reaction-wow"><span class="legend-reaction">Wow</span></button>
										<button class="reaction-sad"><span class="legend-reaction">Sad</span></button>
										<button class="reaction-angry"><span class="legend-reaction">Angry</span></button>
									</div> -->
									<div class="list-group" id="chats" role="tablist">

										{% for u in all_rooms %}
											<a href="{% url 'chatroom' u.group_name %}" class="filterDiscussions all unread single active" id="msg__{{ u.group_name }}">

											{% if u.one_to_one == False %}
												<img class="avatar-md" src="/{{u.group.group_image}}" data-toggle="tooltip" data-placement="top" title="{{u.group_name}}" alt="avatar">
											{% elif u.first_user.user == request.user %}
												<img class="avatar-md" src="/{{ u.second_user.all.first.prof_image }}" data-toggle="tooltip" data-placement="top" title="{{u.second_user.all.first.user.username|capfirst}}" alt="avatar">
											{% elif u.second_user.all.first.user == request.user %}
												<img class="avatar-md" src="/{{ u.first_user.prof_image }}" data-toggle="tooltip" data-placement="top" title="{{u.first_user.user.username|capfirst}}" alt="avatar">
											{% endif %}
			
											<div class="status">
												<i class="material-icons online">fiber_manual_record</i>
											</div>
											<!-- <div class="new bg-red">
												<span>+7</span>
											</div> -->
											<div class="data">
												{% if u.one_to_one == True and u.first_user.user == request.user %}
													<h5>{{ u.second_user.all.first.user.username|capfirst }}</h5>
												{% elif u.one_to_one == True and u.second_user.all.first.user == request.user %}
													<h5>{{ u.first_user.user.username }}</h5>
												{% else %}
													<h5>{{ u.group_name|capfirst }}</h5>
												{% endif %}
												
												<span>Mon</span>
												<p id="{{u.group_name}}_message" style="color:rgb(158, 157, 157);"><b>
													{{ u.LatestMessage.message|truncatechars:25 }}
												</b></p>
											</div>
										</a>
										{% endfor %}


											<!-- {% for u in all_usr.friends.all %}

												{% if u.username == usr2.username %}
													<a href="{% url 'chatroom' u.id %}" class="filterDiscussions all unread single active" id="msg__{{u.user.username}}">
												{% else %}
													<a href="{% url 'chatroom' u.id %}" class="filterDiscussions all unread single" id="msg__{{u.user.username}}">
												{% endif %}
													<img class="avatar-md" src="/{{u.prof_image}}" data-toggle="tooltip" data-placement="top" title="Janette" alt="avatar">
													<div class="status">
														<i class="material-icons online">fiber_manual_record</i>
													</div>
													<div class="new bg-red">
														<span>+7</span>
													</div>
													<div class="data">
														<h5>{{u.user.username|capfirst}}</h5>
														<span>Mon</span>
														<p id="{{u.user.username}}_message" style="color:rgb(158, 157, 157);"><b>
															{% for m in msgs %}
																{% if m.sender == u or m.receiver == u %}
																	{{m.message|truncatechars:25}}
																{% endif %}
															{% endfor %}
														</b></p>
													</div>
												</a>
											{% endfor %} -->

											<!-- <a href="#list-empty" class="filterDiscussions all unread single" id="list-empty-list" data-toggle="list" role="tab">
												<img class="avatar-md" src="{% static 'dist/img/avatars/avatar-male-1.jpg' %}" data-toggle="tooltip" data-placement="top" title="Michael" alt="avatar">
												<div class="status">
													<i class="material-icons offline">fiber_manual_record</i>
												</div>
												<div class="new bg-pink">
													<span>+10</span>
												</div>
												<div class="data">
													<h5>Michael Knudsen</h5>
													<span>Sun</span>
													<p>How can i improve my chances of getting a deposit?</p>
												</div>
											</a>									 -->
										</div>
									</div>
								</div>
								<!-- End of Discussions -->
								<!-- Start of Notifications -->
								<div id="notifications" class="tab-pane fade">
									<div class="search">
										<form class="form-inline position-relative">
											<input type="search" class="form-control" id="notice" placeholder="Filter notifications...">
											<button type="button" class="btn btn-link loop"><i class="material-icons filter-list">filter_list</i></button>
										</form>
									</div>
									<div class="list-group sort">
										<button class="btn filterNotificationsBtn active show" data-toggle="list" data-filter="all">All</button>
										<button class="btn filterNotificationsBtn" data-toggle="list" data-filter="latest">Latest</button>
										<button class="btn filterNotificationsBtn" data-toggle="list" data-filter="oldest">Oldest</button>
									</div>						
									<div class="notifications">
										<h1>Notifications</h1>
										<div class="list-group" id="alerts" role="tablist">
											
											{% for notification in notifications %}
												<a href="#" class="filterNotifications all latest notification" data-toggle="list">
													<img class="avatar-md" src="/{{notification.from_user.prof_image}}" data-toggle="tooltip" data-placement="top" title="{{notification.from_user.user.username|capfirst}}" alt="avatar">
													<div class="status">
														<i class="material-icons online">fiber_manual_record</i>
													</div>
													<div class="data">
														<p>{{notification.message|capfirst}}.</p>
														<span>{{notification.created_at}}</span>
													</div>
													<div class="">
														<button class="btn btn-secondary" style="background-color:#00b797" data-toggle="modal" data-target="#notif_{{notification.id}}" >view</button>
													</div>
												</a>

											<div id="notif_{{notification.id}}" class="modal fade forget-modal" tabindex="-1" role="dialog" aria-hidden="true">
												<div class="modal-dialog modal-dialog-centered" role="document">
													<div class="requests">
														<div class="title">
															<!-- <h1>Add your friends</h1> -->
															<button type="button" class="btn" data-dismiss="modal" aria-label="Close"><i class="material-icons">close</i></button>
														</div>
														<div class="content">
																<div class="form-group">
																	<center>
																		<img class="avatar-lg" src="/{{notification.from_user.prof_image}}" style="height:100px;max-width:100px;margin-top:-50px;" data-toggle="tooltip" data-placement="top" alt="avatar"><br>
																		<br><h5 style="color:rgb(20, 20, 20)"><b>{{notification.from_user.user.username|capfirst}}</b></h5>
																	</center>
																</div>
																<div class="form-group">
																	<h5 id="{{notification.id}}__msg"><b>{{notification.message|capfirst}}</b></h5>
																</div>
																{% if notification.notification_type == "Friend Request" %}
																	{% with notif_msg=notification.message %}
																		{% if "Rejected" not in notif_msg and "Accepted" not in notif_msg %}
																			<div class="row" id="notifBtn_{{notification.id}}">
																				<div class="col-md-5">
																					<button type="submit" onclick="notification_form('{{notification.id}}','{{notification.from_user.id}}','Accepted');" style="background-color:#17cf60;" class="btn button w-100">Accept</button>
																				</div>
																				<div class="col-md-5">
																					<button type="submit" onclick="notification_form('{{notification.id}}','{{notification.from_user.id}}','Rejected');" style="background-color:#ff4848;" class="btn button w-100">Reject</button>
																				</div>
																			</div>
																		{% endif %}
																	{% endwith %}
																{% endif %}
														</div>
													</div>
												</div>
											</div>

											{% endfor %}

										</div>
									</div>
								</div>
								<!-- End of Notifications -->
								<!-- Start of Settings -->
								<div class="tab-pane fade" id="settings">
									<div class="settings">
										<div class="profile">
											<img class="avatar-xl" src="{% static 'dist/img/avatars/avatar-male-1.jpg' %}" alt="avatar">
											<h1><a href="#">{{ request.user.username|capfirst }}</a></h1>
											<span>Helena, Montana</span>
											<div class="stats">
												<div class="item">
													<h2>122</h2>
													<h3>Fellas</h3>
												</div>
												<div class="item">
													<h2>0</h2>
													<h3>Chats</h3>
												</div>
												<div class="item">
													<h2>1538</h2>
													<h3>Posts</h3>
												</div>
											</div>
										</div>
										<div class="categories" id="accordionSettings">
											<h1>Settings</h1>
											<!-- Start of My Account -->
											<div class="category">
												<a href="#" class="title collapsed" id="headingOne" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
													<i class="material-icons md-30 online">person_outline</i>
													<div class="data">
														<h5>My Account</h5>
														<p>Update your profile details</p>
													</div>
													<i class="material-icons">keyboard_arrow_right</i>
												</a>
												<div class="collapse" id="collapseOne" aria-labelledby="headingOne" data-parent="#accordionSettings">
													<div class="content">
														<div class="upload">
															<div class="data">
																<img class="avatar-xl" src="{% static 'dist/img/avatars/avatar-male-1.jpg' %}" alt="image">
																<label>
																	<input type="file">
																	<span class="btn button">Upload avatar</span>
																</label>
															</div>
															<p>For best results, use an image at least 256px by 256px in either .jpg or .png format!</p>
														</div>
														<form>
															<div class="parent">
																<div class="field">
																	<label for="firstName">First name <span>*</span></label>
																	<input type="text" class="form-control" id="firstName" placeholder="First name" value="Michael" required>
																</div>
																<div class="field">
																	<label for="lastName">Last name <span>*</span></label>
																	<input type="text" class="form-control" id="lastName" placeholder="Last name" value="Knudsen" required>
																</div>
															</div>
															<div class="field">
																<label for="email">Email <span>*</span></label>
																<input type="email" class="form-control" id="email" placeholder="Enter your email address" value="michael@gmail.com" required>
															</div>
															<div class="field">
																<label for="password">Password</label>
																<input type="password" class="form-control" id="password" placeholder="Enter a new password" value="password" required>
															</div>
															<div class="field">
																<label for="location">Location</label>
																<input type="text" class="form-control" id="location" placeholder="Enter your location" value="Helena, Montana" required>
															</div>
															<button class="btn btn-link w-100">Delete Account</button>
															<button type="submit" class="btn button w-100">Apply</button>
														</form>
													</div>
												</div>
											</div>
											<!-- End of My Account -->
											<!-- Start of Chat History -->
											<div class="category">
												<a href="#" class="title collapsed" id="headingTwo" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
													<i class="material-icons md-30 online">mail_outline</i>
													<div class="data">
														<h5>Chats</h5>
														<p>Check your chat history</p>
													</div>
													<i class="material-icons">keyboard_arrow_right</i>
												</a>
												<div class="collapse" id="collapseTwo" aria-labelledby="headingTwo" data-parent="#accordionSettings">
													<div class="content layer">
														<div class="history">
															<p>When you clear your conversation history, the messages will be deleted from your own device.</p>
															<p>The messages won't be deleted or cleared on the devices of the people you chatted with.</p>
															<div class="custom-control custom-checkbox">
																<input type="checkbox" class="custom-control-input" id="same-address">
																<label class="custom-control-label" for="same-address">Hide will remove your chat history from the recent list.</label>
															</div>
															<div class="custom-control custom-checkbox">
																<input type="checkbox" class="custom-control-input" id="save-info">
																<label class="custom-control-label" for="save-info">Delete will remove your chat history from the device.</label>
															</div>
															<button type="submit" class="btn button w-100">Clear blah-blah</button>
														</div>
													</div>
												</div>
											</div>
											<!-- End of Chat History -->
											<!-- Start of Notifications Settings -->
											<div class="category">
												<a href="#" class="title collapsed" id="headingThree" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
													<i class="material-icons md-30 online">notifications_none</i>
													<div class="data">
														<h5>Notifications</h5>
														<p>Turn notifications on or off</p>
													</div>
													<i class="material-icons">keyboard_arrow_right</i>
												</a>
												<div class="collapse" id="collapseThree" aria-labelledby="headingThree" data-parent="#accordionSettings">
													<div class="content no-layer">
														<div class="set">
															<div class="details">
																<h5>Desktop Notifications</h5>
																<p>You can set up Swipe to receive notifications when you have new messages.</p>
															</div>
															<label class="switch">
																<input type="checkbox" checked>
																<span class="slider round"></span>
															</label>
														</div>
														<div class="set">
															<div class="details">
																<h5>Unread Message Badge</h5>
																<p>If enabled shows a red badge on the Swipe app icon when you have unread messages.</p>
															</div>
															<label class="switch">
																<input type="checkbox" checked>
																<span class="slider round"></span>
															</label>
														</div>
														<div class="set">
															<div class="details">
																<h5>Taskbar Flashing</h5>
																<p>Flashes the Swipe app on mobile in your taskbar when you have new notifications.</p>
															</div>
															<label class="switch">
																<input type="checkbox">
																<span class="slider round"></span>
															</label>
														</div>
														<div class="set">
															<div class="details">
																<h5>Notification Sound</h5>
																<p>Set the app to alert you via notification sound when you have unread messages.</p>
															</div>
															<label class="switch">
																<input type="checkbox" checked>
																<span class="slider round"></span>
															</label>
														</div>
														<div class="set">
															<div class="details">
																<h5>Vibrate</h5>
																<p>Vibrate when receiving new messages (Ensure system vibration is also enabled).</p>
															</div>
															<label class="switch">
																<input type="checkbox">
																<span class="slider round"></span>
															</label>
														</div>
														<div class="set">
															<div class="details">
																<h5>Turn On Lights</h5>
																<p>When someone send you a text message you will receive alert via notification light.</p>
															</div>
															<label class="switch">
																<input type="checkbox">
																<span class="slider round"></span>
															</label>
														</div>
													</div>
												</div>
											</div>
											<!-- End of Notifications Settings -->
											<!-- Start of Connections -->
											<div class="category">
												<a href="#" class="title collapsed" id="headingFour" data-toggle="collapse" data-target="#collapseFour" aria-expanded="true" aria-controls="collapseFour">
													<i class="material-icons md-30 online">sync</i>
													<div class="data">
														<h5>Connections</h5>
														<p>Sync your social accounts</p>
													</div>
													<i class="material-icons">keyboard_arrow_right</i>
												</a>
												<div class="collapse" id="collapseFour" aria-labelledby="headingFour" data-parent="#accordionSettings">
													<div class="content">
														<div class="app">
															<img src="{% static 'dist/img/integrations/slack.svg' %}" alt="app">
															<div class="permissions">
																<h5>Skrill</h5>
																<p>Read, Write, Comment</p>
															</div>
															<label class="switch">
																<input type="checkbox" checked>
																<span class="slider round"></span>
															</label>
														</div>
														<div class="app">
															<img src="{% static 'dist/img/integrations/dropbox.svg' %}" alt="app">
															<div class="permissions">
																<h5>Dropbox</h5>
																<p>Read, Write, Upload</p>
															</div>
															<label class="switch">
																<input type="checkbox" checked>
																<span class="slider round"></span>
															</label>
														</div>
														<div class="app">
															<img src="{% static 'dist/img/integrations/drive.svg' %}" alt="app">
															<div class="permissions">
																<h5>Google Drive</h5>
																<p>No permissions set</p>
															</div>
															<label class="switch">
																<input type="checkbox">
																<span class="slider round"></span>
															</label>
														</div>
														<div class="app">
															<img src="{% static 'dist/img/integrations/trello.svg' %}" alt="app">
															<div class="permissions">
																<h5>Trello</h5>
																<p>No permissions set</p>
															</div>
															<label class="switch">
																<input type="checkbox">
																<span class="slider round"></span>
															</label>
														</div>
													</div>
												</div>
											</div>
											<!-- End of Connections -->
											<!-- Start of Appearance Settings -->
											<div class="category">
												<a href="#" class="title collapsed" id="headingFive" data-toggle="collapse" data-target="#collapseFive" aria-expanded="true" aria-controls="collapseFive">
													<i class="material-icons md-30 online">colorize</i>
													<div class="data">
														<h5>Appearance</h5>
														<p>Customize the look of Swipe</p>
													</div>
													<i class="material-icons">keyboard_arrow_right</i>
												</a>
												<div class="collapse" id="collapseFive" aria-labelledby="headingFive" data-parent="#accordionSettings">
													<div class="content no-layer">
														<div class="set">
															<div class="details">
																<h5>Turn Off Lights</h5>
																<p>The dark mode is applied to core areas of the app that are normally displayed as light.</p>
															</div>
															<label class="switch">
																<input type="checkbox">
																<span class="slider round mode"></span>
															</label>
														</div>
													</div>
												</div>
											</div>
											<!-- End of Appearance Settings -->
											<!-- Start of Language -->
											<div class="category">
												<a href="#" class="title collapsed" id="headingSix" data-toggle="collapse" data-target="#collapseSix" aria-expanded="true" aria-controls="collapseSix">
													<i class="material-icons md-30 online">language</i>
													<div class="data">
														<h5>Language</h5>
														<p>Select preferred language</p>
													</div>
													<i class="material-icons">keyboard_arrow_right</i>
												</a>
												<div class="collapse" id="collapseSix" aria-labelledby="headingSix" data-parent="#accordionSettings">
													<div class="content layer">
														<div class="language">
															<label for="country">Language</label>
															<select class="custom-select" id="country" required>
																<option value="">Select an language...</option>
																<option>English, UK</option>
																<option>English, US</option>
															</select>
														</div>
													</div>
												</div>
											</div>
											<!-- End of Language -->
											<!-- Start of Privacy & Safety -->
											<div class="category">
												<a href="#" class="title collapsed" id="headingSeven" data-toggle="collapse" data-target="#collapseSeven" aria-expanded="true" aria-controls="collapseSeven">
													<i class="material-icons md-30 online">lock_outline</i>
													<div class="data">
														<h5>Privacy & Safety</h5>
														<p>Control your privacy settings</p>
													</div>
													<i class="material-icons">keyboard_arrow_right</i>
												</a>
												<div class="collapse" id="collapseSeven" aria-labelledby="headingSeven" data-parent="#accordionSettings">
													<div class="content no-layer">
														<div class="set">
															<div class="details">
																<h5>Keep Me Safe</h5>
																<p>Automatically scan and delete direct messages you receive from everyone that contain explict content.</p>
															</div>
															<label class="switch">
																<input type="checkbox">
																<span class="slider round"></span>
															</label>
														</div>
														<div class="set">
															<div class="details">
																<h5>Everyone can add me</h5>
																<p>If enabled anyone in or out your friends of friends list can send you a friend request.</p>
															</div>
															<label class="switch">
																<input type="checkbox" checked>
																<span class="slider round"></span>
															</label>
														</div>
														<div class="set">
															<div class="details">
																<h5>Friends of Friends</h5>
																<p>Only your friends or your mutual friends will be able to send you a friend reuqest.</p>
															</div>
															<label class="switch">
																<input type="checkbox" checked>
																<span class="slider round"></span>
															</label>
														</div>
														<div class="set">
															<div class="details">
																<h5>Data to Improve</h5>
																<p>This settings allows us to use and process information for analytical purposes.</p>
															</div>
															<label class="switch">
																<input type="checkbox">
																<span class="slider round"></span>
															</label>
														</div>
														<div class="set">
															<div class="details">
																<h5>Data to Customize</h5>
																<p>This settings allows us to use your information to customize Swipe for you.</p>
															</div>
															<label class="switch">
																<input type="checkbox">
																<span class="slider round"></span>
															</label>
														</div>
													</div>
												</div>
											</div>
											<!-- End of Privacy & Safety -->
											<!-- Start of Logout -->
											<div class="category">
												<a href="sign-in.html" class="title collapsed">
													<i class="material-icons md-30 online">power_settings_new</i>
													<div class="data">
														<h5>Power Off</h5>
														<p>Log out of your account</p>
													</div>
													<i class="material-icons">keyboard_arrow_right</i>
												</a>
											</div>
											<!-- End of Logout -->
										</div>
									</div>
								</div>
								<!-- End of Settings -->
							</div>
						</div>
					</div>
				</div>
				<!-- End of Sidebar -->
				<!-- Start of Create Chat -->
				<div class="modal fade" id="startnewchat" tabindex="-1" role="dialog" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="requests">
							<div class="title">
								<h1>Start new chat</h1>
								<button type="button" class="btn" data-dismiss="modal" aria-label="Close"><i class="material-icons">close</i></button>
							</div>
							<div class="content">
								<form>
									<div class="form-group">
										<label for="participant">Recipient:</label>
										<input type="text" class="form-control" id="participant" placeholder="Add recipient..." required>
										<div class="user" id="recipient">
											<img class="avatar-sm" src="{% static 'dist/img/avatars/avatar-female-5.jpg' %}" alt="avatar">
											<h5>Keith Morris</h5>
											<button class="btn"><i class="material-icons">close</i></button>
										</div>
									</div>
									<div class="form-group">
										<label for="topic">Topic:</label>
										<input type="text" class="form-control" id="topic" placeholder="What's the topic?" required>
									</div>
									<div class="form-group">
										<label for="message">Message:</label>
										<textarea class="text-control" id="message" placeholder="Send your welcome message...">Hmm, are you friendly?</textarea>
									</div>
									<button type="submit" class="btn button w-100">Start New Chat</button>
								</form>
							</div>
						</div>
					</div>
				</div>
				<!-- End of Create Chat -->
				<div class="main">
					<div class="tab-content" id="nav-tabContent">
						<!-- Start of Babble -->
						<div class="babble tab-pane fade active show" id="list-chat" role="tabpanel" aria-labelledby="list-chat-list">
							<!-- Start of Chat -->
							<div class="chat" id="chat1">
								<div class="top">
									<div class="container">
										<div class="col-md-12">
											<div class="inside">
												{% if usr2.one_to_one == False %}
													<a href="#"><img class="avatar-md" src="/{{ usr2.group.group_image }}" data-toggle="tooltip" data-placement="top" title="{{usr2.group_name}}" alt="avatar"></a>
													<div class="status">
														<i class="material-icons online">fiber_manual_record</i>
													</div>
													<div class="data">
														<h5>{{ usr2.group_name|capfirst }}</h5>
														<span>Active now</span>
													</div>
												{% else %}
													<a href="#"><img class="avatar-md" src="/{{ usr2.prof_image }}" data-toggle="tooltip" data-placement="top" title="Keith" alt="avatar"></a>
													<div class="status">
														<i class="material-icons online">fiber_manual_record</i>
													</div>
													<div class="data">
														<h5>{{ usr2.user.username|capfirst }}</h5>
														<span>Active now</span>
													</div>
												{% endif %}
	
												<button class="btn connect d-md-block d-none" name="1"><i class="material-icons md-30">phone_in_talk</i></button>
												<button class="btn connect d-md-block d-none" name="1"><i class="material-icons md-36">videocam</i></button>
												<button class="btn d-md-block d-none"><i class="material-icons md-30">info</i></button>



												<div class="dropdown">


													<button class="btn" data-toggle="modal" data-target="#group_settings" tabindex="-1" role="dialog" aria-hidden="true"><i class="material-icons md-30">more_vert</i></button>

													<!-- <button class="btn btn-danger" style="background-color:#dc3545;" data-toggle="modal" data-target="#group_settings">Create Group</button> -->

													<div id="group_settings" class="modal fade forget-modal" tabindex="-1" role="dialog" aria-hidden="true">
														<div class="modal-dialog modal-dialog-centered" role="document">
															<div class="requests">
																<div class="title">
																	<h1>Settings</h1>
																	<button type="button" class="btn" data-dismiss="modal" aria-label="Close"><i class="material-icons">close</i></button>
																</div>
																<div class="form-group">
																	{% if usr2.one_to_one == False %}
																		<form action="{% url 'add_to_group' usr2.id %}" method="post">
																			{% csrf_token %}
																			<label for="">Add friends</label>
																			<center>
																				<input class="form-control" type="text" value="Enter username here.." name="user_add_group" required>
																				<button type="submit" class="btn btn-primary">Add</button>
																			</center>
																		</form>
																	{% else %}
																		<form action="{% url 'remove_from_group' usr2.user.id %}" method="post">
																			{% csrf_token %}
																			<h4>Unfriend</h4>
																			<center>
																				<h5>Are you sure you want to unfriend ?</h5>
																				<button type="submit" class="btn btn-danger">Unfriend</button>
																			</center>
																		</form>
																	{% endif %}
																</div>
															</div>
														</div>
													</div>
			
													<div class="dropdown-menu dropdown-menu-right">
														<button class="dropdown-item connect" name="1"><i class="material-icons">phone_in_talk</i>Voice Call</button>
														<button class="dropdown-item connect" name="1"><i class="material-icons">videocam</i>Video Call</button>
														<hr>
														<button class="dropdown-item"><i class="material-icons">clear</i>Clear History</button>
														<button class="dropdown-item"><i class="material-icons">block</i>Block Contact</button>
														<button class="dropdown-item"><i class="material-icons">delete</i>Delete Contact</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								
								<div class="content" id="content">
									<div class="container">
										<div class="col-md-12" id="msg_body">
											<div class="date">
												<hr>
												<span>Yesterday</span>
												<hr>
											</div>
											<!-- <div class="date">
												<hr>
												<span>Today</span>
												<hr>
											</div> -->

											{% for m in msg %}
												<!-- {{m.sender.username}} -- {{request.user.username}} -->
												{% if m.sender.user.username != request.user.username %}
													<div class="message" id="msgs_{{m.id}}">
														<img class="avatar-md" src="/{{m.sender.prof_image}}" data-toggle="tooltip_{{m.id}}" data-placement="top_{{m.id}}" title="{{m.username|capfirst}}" alt="avatar">
														<div class="text-main">
															<div class="text-group">
																<div class="text">
																	{% if m.file %}
																		<div class="attachment">
																			<button class="btn attach"><i class="material-icons md-18">insert_drive_file</i></button>
																			<div class="file">
																				<h5><a href="/{{m.file}}" download>{{m.file}}</a></h5>
																				<span>24kb Document</span>
																			</div>
																		</div>
																	{% endif %}
																	<p id="msg_{{m.id}}">{{m.message}}</p>
																</div>
															</div>
															<span>{{m.date}}</span>
														</div>
													</div>
												{% else %}
												<div class="message me" id="msgs_{{m.id}}">
													<div class="text-main">
														<div class="text-group me">
															<div class="text me">
																	{% if m.file %}
																		<div class="attachment">
																			<button class="btn attach"><i class="material-icons md-18">insert_drive_file</i></button>
																			<div class="file">
																				<h5><a  href="/{{m.file}}" download>{{m.file}}</a></h5>
																				<span>24kb Document</span>
																			</div>
																		</div>
																	{% endif %}
														<!-- <p id="msg_{{m.id}}"><a href="#" onclick="Edit_Message('{{m.id}}')"><i class="material-icons sm-30" style="font-size:smaller;">more_vert</i></a> {{m.message}}</p>
																<button onclick="MessageDelete('{{m.id}}','{{usr2.id}}')">delete</button> -->
																	<div class="dropdown" style="width:10%;margin-left:-15px;">
																			<a href="#" onclick="myFunction('dropdown_{{m.id}}')"><i class="material-icons sm-30 dropbtn" style="font-size:smaller;color:white;">more_vert</i></a>
																			<div id="dropdown_{{m.id}}" class="dropdown-content">
																			<a onclick="Edit_Message('{{m.id}}')" href="#">Edit</a>
																			<a onclick="MessageDelete('{{m.id}}','{{usr2.id}}')" href="#">Delete</a>
																			<a href="#reply">Reply</a>
																		</div>
																	</div>
																	<p id="msg_{{m.id}}" style="color:white;margin-top:-25px;">
																		{{m.message}}</p>
																</div>
																	</div>
																{% if m.receiver == m.seen_by_users %}
																<span>
																	<svg id="msg_tick_{{m.id}}" style="color:skyblue" viewBox="0 0 16 11" height="11" width="16" preserveAspectRatio="xMidYMid meet" class="" fill="none">
																		<path d="M11.0714 0.652832C10.991 0.585124 10.8894 0.55127 10.7667 0.55127C10.6186 0.55127 10.4916 0.610514 10.3858 0.729004L4.19688 8.36523L1.79112 6.09277C1.7488 6.04622 1.69802 6.01025 1.63877 5.98486C1.57953 5.95947 1.51817 5.94678 1.45469 5.94678C1.32351 5.94678 1.20925 5.99544 1.11192 6.09277L0.800883 6.40381C0.707784 6.49268 0.661235 6.60482 0.661235 6.74023C0.661235 6.87565 0.707784 6.98991 0.800883 7.08301L3.79698 10.0791C3.94509 10.2145 4.11224 10.2822 4.29844 10.2822C4.40424 10.2822 4.5058 10.259 4.60313 10.2124C4.70046 10.1659 4.78086 10.1003 4.84434 10.0156L11.4903 1.59863C11.5623 1.5013 11.5982 1.40186 11.5982 1.30029C11.5982 1.14372 11.5348 1.01888 11.4078 0.925781L11.0714 0.652832ZM8.6212 8.32715C8.43077 8.20866 8.2488 8.09017 8.0753 7.97168C7.99489 7.89128 7.8891 7.85107 7.75791 7.85107C7.6098 7.85107 7.4892 7.90397 7.3961 8.00977L7.10411 8.33984C7.01947 8.43717 6.97715 8.54508 6.97715 8.66357C6.97715 8.79476 7.0237 8.90902 7.1168 9.00635L8.1959 10.0791C8.33132 10.2145 8.49636 10.2822 8.69102 10.2822C8.79681 10.2822 8.89838 10.259 8.99571 10.2124C9.09304 10.1659 9.17556 10.1003 9.24327 10.0156L15.8639 1.62402C15.9358 1.53939 15.9718 1.43994 15.9718 1.32568C15.9718 1.1818 15.9125 1.05697 15.794 0.951172L15.4386 0.678223C15.3582 0.610514 15.2587 0.57666 15.1402 0.57666C14.9964 0.57666 14.8715 0.635905 14.7657 0.754395L8.6212 8.32715Z" fill="currentColor"></path>
																	</svg>
																	{% else %}							
																	<svg id="msg_tick_{{m.id}}" viewBox="0 0 16 11" height="11" width="16" preserveAspectRatio="xMidYMid meet" class="" fill="none">
																		<path d="M11.0714 0.652832C10.991 0.585124 10.8894 0.55127 10.7667 0.55127C10.6186 0.55127 10.4916 0.610514 10.3858 0.729004L4.19688 8.36523L1.79112 6.09277C1.7488 6.04622 1.69802 6.01025 1.63877 5.98486C1.57953 5.95947 1.51817 5.94678 1.45469 5.94678C1.32351 5.94678 1.20925 5.99544 1.11192 6.09277L0.800883 6.40381C0.707784 6.49268 0.661235 6.60482 0.661235 6.74023C0.661235 6.87565 0.707784 6.98991 0.800883 7.08301L3.79698 10.0791C3.94509 10.2145 4.11224 10.2822 4.29844 10.2822C4.40424 10.2822 4.5058 10.259 4.60313 10.2124C4.70046 10.1659 4.78086 10.1003 4.84434 10.0156L11.4903 1.59863C11.5623 1.5013 11.5982 1.40186 11.5982 1.30029C11.5982 1.14372 11.5348 1.01888 11.4078 0.925781L11.0714 0.652832ZM8.6212 8.32715C8.43077 8.20866 8.2488 8.09017 8.0753 7.97168C7.99489 7.89128 7.8891 7.85107 7.75791 7.85107C7.6098 7.85107 7.4892 7.90397 7.3961 8.00977L7.10411 8.33984C7.01947 8.43717 6.97715 8.54508 6.97715 8.66357C6.97715 8.79476 7.0237 8.90902 7.1168 9.00635L8.1959 10.0791C8.33132 10.2145 8.49636 10.2822 8.69102 10.2822C8.79681 10.2822 8.89838 10.259 8.99571 10.2124C9.09304 10.1659 9.17556 10.1003 9.24327 10.0156L15.8639 1.62402C15.9358 1.53939 15.9718 1.43994 15.9718 1.32568C15.9718 1.1818 15.9125 1.05697 15.794 0.951172L15.4386 0.678223C15.3582 0.610514 15.2587 0.57666 15.1402 0.57666C14.9964 0.57666 14.8715 0.635905 14.7657 0.754395L8.6212 8.32715Z" fill="currentColor"></path>
																	</svg>
																	{% endif %}
															{{m.date}}</span>
													</div>
												</div>
												<!-- <p id="msg_{{m.id}}">
													<div class="dropdown">
															<a href="#" onclick="myFunction()"><i class="material-icons sm-30 dropbtn" style="font-size:smaller;">more_vert</i></a>
															<div id="myDropdown" class="dropdown-content">
															<a onclick="Edit_Message('{{m.id}}')" href="#">Edit</a>
															<a onclick="MessageDelete('{{m.id}}','{{usr2.id}}')" href="#">Delete</a>
															<a href="#reply">Reply</a>
														</div>
													</div>
													{{m.message}}</p> -->
							
												{% endif %}
											{% endfor %}
																				
											<div class="message" id="typing_div" style="display:none;">
												<img class="avatar-md" src="{% static 'dist/img/avatars/avatar-female-5.jpg' %}" data-toggle="tooltip" data-placement="top" title="Keith" alt="avatar">
												<div class="text-main">
													<div class="text-group">
														<div class="text typing">
															<div class="wave">
																<span class="dot"></span>
																<span class="dot"></span>
																<span class="dot"></span>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="container">
									<div class="col-md-12">
										<div class="bottom">
											{% if usr2 in usr.friends.all %}
												<form id="message_form" class="position-relative w-100">
													<textarea id="message_text" oninput="Typing()" required class="form-control" placeholder="Start typing for reply..." rows="1"></textarea>
													<button class="btn emoticons"><i class="material-icons">insert_emoticon</i></button>
													<button type="submit" class="btn send"><i class="material-icons">send</i></button>
												</form>
											<label>
												<input id="files_input" type="file">
												<span class="btn attach d-sm-block d-none"><i class="material-icons">attach_file</i></span>
											</label> 
											{% endif %}
										</div>
									</div>
								</div>
							</div>
							<!-- End of Chat -->
							<!-- Start of Call -->
							<div class="call" id="call1">
								<div class="content">
									<div class="container">
										<div class="col-md-12">
											<div class="inside">
												<div class="panel">
													<div class="participant">
														<img class="avatar-xxl" src="{% static 'dist/img/avatars/avatar-female-5.jpg' %}" alt="avatar">
														<span>Connecting</span>
													</div>							
													<div class="options">
														<button class="btn option"><i class="material-icons md-30">mic</i></button>
														<button class="btn option"><i class="material-icons md-30">videocam</i></button>
														<button class="btn option call-end"><i class="material-icons md-30">call_end</i></button>
														<button class="btn option"><i class="material-icons md-30">person_add</i></button>
														<button class="btn option"><i class="material-icons md-30">volume_up</i></button>
													</div>
													<button class="btn back" name="1"><i class="material-icons md-24">chat</i></button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- End of Call -->
						</div>
						<!-- End of Babble -->
						<!-- Start of Babble -->
						<div class="babble tab-pane fade" id="list-empty" role="tabpanel" aria-labelledby="list-empty-list">
							<!-- Start of Chat -->
							<div class="chat" id="chat2">
								<div class="top">
									<div class="container">
										<div class="col-md-12">
											<div class="inside">
												<a href="#"><img class="avatar-md" src="{% static 'dist/img/avatars/avatar-female-2.jpg' %}" data-toggle="tooltip" data-placement="top" title="Lean" alt="avatar"></a>
												<div class="status">
													<i class="material-icons offline">fiber_manual_record</i>
												</div>
												<div class="data">
													<h5><a href="#">Lean Avent</a></h5>
													<span>Inactive</span>
												</div>
												<button class="btn connect d-md-block d-none" name="2"><i class="material-icons md-30">phone_in_talk</i></button>
												<button class="btn connect d-md-block d-none" name="2"><i class="material-icons md-36">videocam</i></button>
												<button class="btn d-md-block d-none"><i class="material-icons md-30">info</i></button>
												<div class="dropdown">
													<button class="btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="material-icons md-30">more_vert</i></button>
													<div class="dropdown-menu dropdown-menu-right">
														<button class="dropdown-item connect" name="2"><i class="material-icons">phone_in_talk</i>Voice Call</button>
														<button class="dropdown-item connect" name="2"><i class="material-icons">videocam</i>Video Call</button>
														<hr>
														<button class="dropdown-item"><i class="material-icons">clear</i>Clear History</button>
														<button class="dropdown-item"><i class="material-icons">block</i>Block Contact</button>
														<button class="dropdown-item"><i class="material-icons">delete</i>Delete Contact</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="content empty">
									<div class="container">
										<div class="col-md-12">
											<div class="no-messages">
												<i class="material-icons md-48">forum</i>
												<p>Seems people are shy to start the chat. Break the ice send the first message.</p>
											</div>
										</div>
									</div>
								</div>
								<div class="container">
									<div class="col-md-12">
										<div class="bottom">
											<form class="position-relative w-100">
												<textarea class="form-control" placeholder="Start typing for reply..." rows="1"></textarea>
												<button class="btn emoticons"><i class="material-icons">insert_emoticon</i></button>
												<button type="submit" class="btn send"><i class="material-icons">send</i></button>
											</form>
											<label>
												<input type="file">
												<span class="btn attach d-sm-block d-none"><i class="material-icons">attach_file</i></span>
											</label> 
										</div>
									</div>
								</div>
							</div>
							<!-- End of Chat -->
							<!-- Start of Call -->
							<div class="call" id="call2">
								<div class="content">
									<div class="container">
										<div class="col-md-12">
											<div class="inside">
												<div class="panel">
													<div class="participant">
														<img class="avatar-xxl" src="{% static 'dist/img/avatars/avatar-female-2.jpg' %}" alt="avatar">
														<span>Connecting</span>
													</div>							
													<div class="options">
														<button class="btn option"><i class="material-icons md-30">mic</i></button>
														<button class="btn option"><i class="material-icons md-30">videocam</i></button>
														<button class="btn option call-end"><i class="material-icons md-30">call_end</i></button>
														<button class="btn option"><i class="material-icons md-30">person_add</i></button>
														<button class="btn option"><i class="material-icons md-30">volume_up</i></button>
													</div>
													<button class="btn back" name="2"><i class="material-icons md-24">chat</i></button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- End of Call -->
						</div>
						<!-- End of Babble -->
						<!-- Start of Babble -->
						<div class="babble tab-pane fade" id="list-request" role="tabpanel" aria-labelledby="list-request-list">
							<!-- Start of Chat -->
							<div class="chat" id="chat3">
								<div class="top">
									<div class="container">
										<div class="col-md-12">
											<div class="inside">
												<a href="#"><img class="avatar-md" src="{% static 'dist/img/avatars/avatar-female-6.jpg' %}" data-toggle="tooltip" data-placement="top" title="Louis" alt="avatar"></a>
												<div class="status">
													<i class="material-icons offline">fiber_manual_record</i>
												</div>
												<div class="data">
													<h5><a href="#">Louis Martinez</a></h5>
													<span>Inactive</span>
												</div>
												<button class="btn disabled d-md-block d-none" disabled><i class="material-icons md-30">phone_in_talk</i></button>
												<button class="btn disabled d-md-block d-none" disabled><i class="material-icons md-36">videocam</i></button>
												<button class="btn d-md-block disabled d-none" disabled><i class="material-icons md-30">info</i></button>
												<div class="dropdown">
													<button class="btn disabled" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" disabled><i class="material-icons md-30">more_vert</i></button>
													<div class="dropdown-menu dropdown-menu-right">
														<button class="dropdown-item"><i class="material-icons">phone_in_talk</i>Voice Call</button>
														<button class="dropdown-item"><i class="material-icons">videocam</i>Video Call</button>
														<hr>
														<button class="dropdown-item"><i class="material-icons">clear</i>Clear History</button>
														<button class="dropdown-item"><i class="material-icons">block</i>Block Contact</button>
														<button class="dropdown-item"><i class="material-icons">delete</i>Delete Contact</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="content empty">
									<div class="container">
										<div class="col-md-12">
											<div class="no-messages request">
												<a href="#"><img class="avatar-xl" src="{% static 'dist/img/avatars/avatar-female-6.jpg' %}" data-toggle="tooltip" data-placement="top" title="Louis" alt="avatar"></a>
												<h5>Louis Martinez would like to add you as a contact. <span>Hi Keith, I'd like to add you as a contact.</span></h5>
												<div class="options">
													<button class="btn button"><i class="material-icons">check</i></button>
													<button class="btn button"><i class="material-icons">close</i></button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="container">
									<div class="col-md-12">
										<div class="bottom">
											<form class="position-relative w-100">
												<textarea class="form-control" placeholder="Messaging unavailable" rows="1" disabled></textarea>
												<button class="btn emoticons disabled" disabled><i class="material-icons">insert_emoticon</i></button>
												<button class="btn send disabled" disabled><i class="material-icons">send</i></button>
											</form>
											<label>
												<input type="file" disabled>
												<span class="btn attach disabled d-sm-block d-none"><i class="material-icons">attach_file</i></span>
											</label> 
										</div>
									</div>
								</div>
							</div>
							<!-- End of Chat -->
						</div>
						<!-- End of Babble -->
					</div>
				</div>
			</div> <!-- Layout -->
		</main>
		<!-- Bootstrap/Swipe core JavaScript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="{% static 'dist/js/jquery-3.3.1.slim.min.js' %}" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script>window.jQuery || document.write('<script src="{% static "dist/js/vendor/jquery-slim.min.js" %}"><\script>')</script>
		<script src="{% static 'dist/js/vendor/popper.min.js' %}"></script>
		<script src="{% static 'dist/js/swipe.min.js' %}"></script>
		<script src="{% static 'dist/js/bootstrap.min.js' %}"></script>
		<script>
			function scrollToBottom(el) { el.scrollTop = el.scrollHeight; }
			scrollToBottom(document.getElementById('content'));
		</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript">
    // let url = "ws://" + window.location.host +"/ws/socket-server/room_id="+"abcd"
	let url = ""
	console.log("{{ usr2.one_to_one }}")

	if ("{{ usr2.one_to_one }}" == "False"){
		url = "ws://" + window.location.host +"/ws/socket-server/room_id="+"{{ usr2.group_name }}";
		console.log("IN else if condition")
	}
	else{
		console.log("--------YES-----ONE TO ONE-----");
		group_n = "{{ room_name.group_name }}"
		group_n = group_n.replace(" ","%20");
		url = "ws://" + window.location.host +"/ws/socket-server/room_id="+group_n;
	}

	console.log("URL IS "+url)

	let users_chatsocket_url = "ws://" + window.location.host +"/ws/user_chat/room_id="+"{{ usr.user.id }}"
	let message_edit = false
	let message_id = ""
	let msg_audio = new Audio(window.location.origin + "/static/audio/msg_sound.wav");
    const chatSocket = new WebSocket(url)
    const UserchatSocket = new WebSocket(users_chatsocket_url)
	let m_audio = false
    let freq_form = document.getElementById("freq_form")

	function notification_form(id, user_id, decision){

		let msg = document.getElementById(id+'__msg');
		console.log("Called");
		console.log(decision);
		
		UserchatSocket.send(JSON.stringify({
				'from_user':"{{ usr.id }}",
				'to_user':user_id,
				'decision':decision,
				'notification_id':id,
				'type':'friend_request_response'
		}))

		let notif_btns = document.getElementById('notifBtn_'+id);
		notif_btns.remove(notif_btns.firstElementChild)

		msg.innerHTML = '<b>You have ' + decision + ' this friend request</b>'
		

	}

	function friend_form(id,user_id){
		let freq_form = document.getElementById(id);
		let freq_msg = document.getElementById("freq_msg_"+user_id);
		console.log("User id : " + user_id)
		console.log("Message : " + freq_msg.value)
		console.log("Yes Submitted")

			UserchatSocket.send(JSON.stringify({
				'from_user':"{{usr.id}}",
				'to_user':user_id,
				'message':freq_msg.value,
				'type':'friend_request_send'
			}))

		freq_form.reset();
	}


	function ShowNotifications(user,message){
		const  notification = new Notification(
			"New message from " + user,{
			body:message,
			// icon:"{% static 'dist/img/avatars/avatar-male-1.jpg' %}"
		});
	}

	function CheckNotificaion(user,message){
		if (Notification.permission == "granted"){
			// console.log(Notification.permission);
			ShowNotifications(user,message);
		}
		else if(Notification.permission != "denied"){
			Notification.requestPermission().then(permission =>{
				// console.log(permission);
				if (permission =="granted"){
					ShowNotifications(user,message);
				}
			});
		}
	}


	function MessageDelete(msg_id,user_id){
		document.getElementById('msgs_'+msg_id).remove();
			UserchatSocket.send(JSON.stringify({
				'from_user':"{{usr.id}}",
				'to_user':user_id,
				'msg_id':msg_id,
				'type':'message_deletion'
			}))
	}


	UserchatSocket.onmessage = function(e){
		let data = JSON.parse(e.data)
        console.log('-----------NOTIF------------');
		console.log('Data:', data);

		if (data.message.notification_type == "message_notification"){
			ShiftUp(data.message.room);
			document.getElementById( data.message.room + "_message").innerHTML = "<b style='color:black'>"+data.message.message+"</b>";
		}
		else if(data.message.notification_type == "Friend Request"){
			console.log("Friend Request from " + data.message.from_user);

			document.getElementById("alerts").innerHTML += '<a href="#" class="filterNotifications all latest notification active show" data-toggle="list">'+
				'<img class="avatar-md" src="/'+data.message.from_user_image+'" data-toggle="tooltip" data-placement="top" title="" alt="avatar" data-original-title="Admin2">'+
				// '<img class="avatar-md" src="C:\\Users\\DELL\\Desktop\\Projects\\Chat App\\chatapp\\static\\avatar-male-4_Kg5jKe3.jpg" data-toggle="tooltip" data-placement="top" title="" alt="avatar" data-original-title="Admin2">'+
				'<div class="status">'+
					'<i class="material-icons online">fiber_manual_record</i>'+
				'</div>'+
				'<div class="data">'+
					'<p>'+ data.message.message +'</p>'+
					'<span>'+data.message.created_at+'</span>'+
				'</div>'+
				'<div class="">'+
					'<button class="btn btn-secondary" style="background-color:#00b797" data-toggle="modal" data-target="#notif_34">view</button>'+
				'</div>'+
			'</a>'

		}
		else if (data.message.notification_type == "Friend Request Response"){
			console.log("Friend Request Response : " + data.message.from_user);

			document.getElementById("alerts").innerHTML += '<a href="#" class="filterNotifications all latest notification active show" data-toggle="list">'+
				'<img class="avatar-md" src="/'+data.message.from_user_image+'" data-toggle="tooltip" data-placement="top" title="" alt="avatar" data-original-title="Admin2">'+
				// '<img class="avatar-md" src="C:\\Users\\DELL\\Desktop\\Projects\\Chat App\\chatapp\\static\\avatar-male-4_Kg5jKe3.jpg" data-toggle="tooltip" data-placement="top" title="" alt="avatar" data-original-title="Admin2">'+
				'<div class="status">'+
					'<i class="material-icons online">fiber_manual_record</i>'+
				'</div>'+
				'<div class="data">'+
					'<p>'+ data.message.message +'</p>'+
					'<span>'+data.message.created_at+'</span>'+
				'</div>'+
				'<div class="">'+
					'<button class="btn btn-secondary" style="background-color:#00b797" data-toggle="modal" data-target="#notif_34">view</button>'+
				'</div>'+
			'</a>'
		}
		else if(data.notification_type == "Remove_message"){
			console.log("Deleting Message");
			console.log(document.getElementById('msgs_'+data.message.msg_id));
			document.getElementById('msgs_'+data.message.msg_id).remove();
		}
		console.log('-----------NOTIF------------');
		msg_audio.play();
	}


	function ShiftUp(room) {
		var row = document.getElementById('chats');
		var user_div = document.getElementById('msg__'+ room);
		if (row.childNodes[0].nextSibling != user_div){
			console.log("Now Shift it upwards");
			row.insertBefore(user_div, row.firstChild);
		}
	}

    chatSocket.onmessage = function(e){
        let data = JSON.parse(e.data)
        console.log('Data:', data);
        console.log('Data username:', data.username);

		if(data.type == "chat"){
            let msgs = document.getElementById("msg_body")

			if(data.username == "{{ request.user.username }}"){

				let file_input = document.getElementById("files_input")
				var formdata = new FormData();
				formdata.append("files", file_input.files[0]);
				formdata.append("message_id",data.messageId);
				formdata.append("csrfmiddlewaretoken", "{{ csrf_token }}");
				
				if (file_input.files[0] != null){
					$.ajax({
						method: "POST",
						url : "/post_files/",
						processData: false,
						contentType: false,
						mimeType: "multipart/form-data",
						data : formdata,
						success: function(res) {
							console.log("Successfull Response..!!!")
						}
					});

					file_html =	'<div class="attachment">'+
									'<button class="btn attach"><i class="material-icons md-18">insert_drive_file</i></button>'+
										'<div class="file">'+
											'<h5><a  href="/static/'+file_input.files[0].name+'" download>'+file_input.files[0].name+'</a></h5>'+
											'<span>24kb Document</span>'+
										'</div>'+
									'</div>'
				} 
				else{
					file_html = ""
				}


				msgs.innerHTML += '<div class="message me">'+
									'<div class="text-main">'+
										'<div class="text-group me">'+
											'<div class="text me">'+ file_html +
													'<p id="msg_'+ data.messageId +'">'+ data.message +'</p>'+
											'</div>'+
										'</div>'+
										'<span> <svg id="msg_tick_' + data.messageId + '" viewBox="0 0 16 11" height="11" width="16" preserveAspectRatio="xMidYMid meet" class="" fill="none">'
																	+'<path d="M11.0714 0.652832C10.991 0.585124 10.8894 0.55127 10.7667 0.55127C10.6186 0.55127 10.4916 0.610514 10.3858 0.729004L4.19688 8.36523L1.79112 6.09277C1.7488 6.04622 1.69802 6.01025 1.63877 5.98486C1.57953 5.95947 1.51817 5.94678 1.45469 5.94678C1.32351 5.94678 1.20925 5.99544 1.11192 6.09277L0.800883 6.40381C0.707784 6.49268 0.661235 6.60482 0.661235 6.74023C0.661235 6.87565 0.707784 6.98991 0.800883 7.08301L3.79698 10.0791C3.94509 10.2145 4.11224 10.2822 4.29844 10.2822C4.40424 10.2822 4.5058 10.259 4.60313 10.2124C4.70046 10.1659 4.78086 10.1003 4.84434 10.0156L11.4903 1.59863C11.5623 1.5013 11.5982 1.40186 11.5982 1.30029C11.5982 1.14372 11.5348 1.01888 11.4078 0.925781L11.0714 0.652832ZM8.6212 8.32715C8.43077 8.20866 8.2488 8.09017 8.0753 7.97168C7.99489 7.89128 7.8891 7.85107 7.75791 7.85107C7.6098 7.85107 7.4892 7.90397 7.3961 8.00977L7.10411 8.33984C7.01947 8.43717 6.97715 8.54508 6.97715 8.66357C6.97715 8.79476 7.0237 8.90902 7.1168 9.00635L8.1959 10.0791C8.33132 10.2145 8.49636 10.2822 8.69102 10.2822C8.79681 10.2822 8.89838 10.259 8.99571 10.2124C9.09304 10.1659 9.17556 10.1003 9.24327 10.0156L15.8639 1.62402C15.9358 1.53939 15.9718 1.43994 15.9718 1.32568C15.9718 1.1818 15.9125 1.05697 15.794 0.951172L15.4386 0.678223C15.3582 0.610514 15.2587 0.57666 15.1402 0.57666C14.9964 0.57666 14.8715 0.635905 14.7657 0.754395L8.6212 8.32715Z" fill="currentColor"></path>'
																+'</svg>'+
											 new Date().toLocaleTimeString(); +'</span>'
									+'</div></div>'

				if(data.seen == "Yes"){
					document.getElementById("msg_tick_" + data.messageId).style.color = "skyblue";
				}

			}
			else{
				msgs.innerHTML +=   '<div class="message">'+
										'<img class="avatar-md" src="/{{ usr2.prof_image }}" data-toggle="tooltip" data-placement="top" title="{{m.username|capfirst}}" alt="avatar">'+
										'<div class="text-main">'+
											'<div class="text-group">'+
												'<div class="text">'+
													'<p id="msg_'+ data.messageId +'">'+ data.message +'</p>'+
												'</div>'+
											'</div>'+
											'<span>'+ new Date().toLocaleTimeString(); +'</span>'+
										'</div>'+
									'</div>'
				m_audio = true;
				CheckNotificaion(data.username,data.message);
			}

			if (m_audio == true){
				msg_audio.play();
				m_audio = false
			}

        }
        else if(data.type == "update_chat"){
			console.log()
			if (data.receiver == "{{ request.user.id }}"){
				document.getElementById("msg_" + data.msg_id ).innerHTML = data.message;
			}
			else{
				document.getElementById("msg_" + data.msg_id ).innerHTML = data.message;
			}
		}

		else if(data.type == "typing_status"){
			
			if(data.username != "{{ request.user.username }}"){
				console.log("{{ request.user.username }} IS TYPING........");
				document.getElementById("typing_div").style.display="block";
				setTimeout(function(){
					document.getElementById("typing_div").style.display="none";
				}, 3000);
			}
		}
		
		else if(data.type == "message_seen"){
			console.log(data)
			for(i=0; i<data.messages_seen.length; i++){
				console.log("Make these Messages seen");
				console.log(data.messages_seen[i]);
				console.log(data.messages_seen[i]);
				// document.getElementById("msg_" + data.messages_seen[i]).innerHTML += " seen"
				document.getElementById("msg_tick_" + data.messages_seen[i]).style.color = "skyblue";
				console.log("Make these Messages seen")
			}

		}

    }

    let form = document.getElementById("message_form")
	let t_val = true

	function Typing(){

		console.log("Typing");
		typing_div = document.getElementById("typing_div").style.display

		// if(typing_div == "none"){
			chatSocket.send(JSON.stringify({
				'typing':'yes',
				'username':"{{ usr.user.username }}",
				"room_id":"{{ usr.id }}_{{ usr2.id }}"
			}))
		// }
    }

	function Edit_Message(msg_id){
		message_id = msg_id;
		console.log(message_id);
	}

	// Message Submit form
	form.addEventListener('submit', (e)=>{
        e.preventDefault();
		let message = document.getElementById("message_text").value
		// let file_input = document.getElementById("files_input")

		room_id = "{{ room_name.group_name }}"

		if("{{ usr2.one_to_one }}" == "False"){
			room_id = "{{ usr2.group_name }}"
		}

			chatSocket.send(JSON.stringify({
				"message_id":message_id,
				'message':message,
				"files":"",
				'username':"{{usr.user.username}}",
				'receiver':"{{usr2.user.id}}",
				"room_id":room_id
			}))
        form.reset();
		message_id = ""
    })


window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}

function myFunction(id) {
  document.getElementById(id).classList.toggle("show");
}

	</script>

	</body>

</html>